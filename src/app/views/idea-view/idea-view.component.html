<div id="container">

  <app-top-bar left-item="back">
    <div class="spacer"></div>
    <button mat-icon-button [mat-menu-trigger-for]="menu"><mat-icon>more_vert</mat-icon></button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item (click)="onDeleteClick()">Delete</button>
    </mat-menu>
  </app-top-bar>

  <div id="cover">
    <div id="cover-background" class="bg cover" [style.backgroundImage]="chooseCover()"></div>

    <div id="bottom-strip" class="flex gap justify-start">
      @for (g of idea?.goals; track g.id) {
      <app-goal-chip
          [no-label]="true"
          [goal]="g"
          [routerLink]="['/', 'ideas', 'goal', g.id]"
          ></app-goal-chip>
      }
      <div class="spacer"></div>
      <app-like-counter [idea]="idea" (click)="toggleCheer()"></app-like-counter>
    </div>
  </div>

  <div id="page-content" class="flex column large-gap">

    <div id="header" class="flex column align-start">
      <h1 id="title" class="no-margin-bottom">{{ idea?.title }}</h1>
      <div id="author">
        <app-profile-picture [user]="idea?.author" class="pointer"
          [routerLink]="['/', 'ideas', 'user', idea?.author?.id]"></app-profile-picture>
        <p class="no-margin-bottom">
          <span id="author-name" class="pointer" [routerLink]="['/', 'ideas', 'user', idea?.author?.id]">
            {{ idea?.author?.name }}
          </span>
          <span id="date"> - {{ time.makeAgo(idea?.date) }}</span>
        </p>
      </div>
      @if (idea?.externalLinks?.length) {
      <div id="external-links">
        <app-h-scroll left-padding="calc(2 * var(--gutter) + 32px)">
          <mat-icon id="open-in-new">open_in_new</mat-icon>
          @for (el of idea?.externalLinks; track el) {
          <app-external-link [external-link]="el"></app-external-link>
          }
        </app-h-scroll>
        <div id="external-link-label">External links</div>
      </div>
      }
    </div>

    <div id="content" [innerHTML]="idea?.content"></div>

    <app-comment-section [comments]="comments" (sort-by-change)="onSortByChange($event)"
      (post-comment)="postComment($event)" (upvote)="upvoteComment($event)" (downvote)="downvoteComment($event)"
      (delete-vote)="deleteCommentVote($event)" (delete-comment)="deleteComment($event)"></app-comment-section>

  </div>

</div>
